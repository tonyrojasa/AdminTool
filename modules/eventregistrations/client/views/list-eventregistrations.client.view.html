<div ng-if="vm.error">
  <br />
  <div class="alert alert-danger">
    <a href="#" class="close" data-dismiss="alert" ng-click='vm.error = undefined'>&times;</a>
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <strong class="text-danger">Error:</strong>
    <span>{{vm.error}}</span>
  </div>
</div>
<div ng-if="vm.warning">
  <br />
  <div class="alert alert-warning" role="alert">
    <a href="#" class="close" data-dismiss="alert" ng-click='vm.warning = undefined'>&times;</a>
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <strong class="text-warning">Alerta:</strong>
    <span>{{vm.warning}}</span>
  </div>
</div>
<section>
  <div class="page-header">
    <h1>Lista de Inscritos</h1>
  </div>
  <a class="btn btn-primary" data-ui-sref="eventregistrations.create">Nuevo Miembro</a>
  <a class="btn btn-primary" data-ui-sref="eventregistrations.create({newMember:false})">Miembro Existente</a>
  <br /><br />
  <div id="content" data-ng-if="vm.eventregistrations.length">
    <div class="col-md-6 form-group">        
      <label class="control-label" for="event">Evento: </label>  
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.event">
          <ui-select-match  placeholder="Seleccione el tipo de persona...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.events | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.event = undefined" class="btn btn-default">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div>
    <input class="form-control" ng-model="vm.searchFilter" placeholder="Buscar..." type="text"/>
    <br />
    <div id="exportable">
      <table class="table table-condensed">
        <thead>
        <tr>
          <th>#</th>
          <th>Evento</th>
          <th>Fecha de Inscripción</th>
          <th>Grupo</th>
          <th>Nombre Persona Inscrita</th>
          <th>Tipo de Persona</th>
          <th>Saldo ₡</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-class="vm.getStatusClass(eventRegistration)" ng-repeat="eventRegistration in vm.eventregistrations | orderBy:['person.firstName', 'person.lastName', 'person.secondLastName'] | filter: vm.searchFilter | filter: vm.event.name">
          <td>{{eventRegistration.registrationNumber}}</td>
          <td>{{eventRegistration.event.name}}</td>
          <td>{{eventRegistration.registrationDate | date:'dd-MMM-yyyy'}}</td>
          <td>{{eventRegistration.eventPeopleGroup.name}}</td>
          <td>{{eventRegistration.person.firstName}} {{eventRegistration.person.lastName}} {{eventRegistration.person.secondLastName}}</td>
          <td>{{eventRegistration.person.personType.name}}</td>
          <td>{{eventRegistration.balanceAmount | currency:''}}</td>
          <td>    
            <a data-ui-sref="eventregistrations.edit({ eventregistrationId: eventRegistration._id, personId: eventRegistration.person._id })">Editar</a>    
          </td>
          <td>    
            <a ng-if="vm.hasPendingPayment(eventRegistration) || vm.authentication.isUserAdmin()" data-ui-sref="receipts.createFromEventRegistration({ eventregistrationId: eventRegistration._id })">Realizar Pago</a>    
          </td>
          <td>
            <a ng-if="vm.authentication.isUserAdmin()" class="btn btn-default" data-ng-click="vm.remove(eventRegistration)">
              <i class="glyphicon glyphicon-trash"></i>
            </a>
          </td>
        </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="5"></td>            
            <td align="right"><b>Total:</b></td>
            <td ng-class="vm.getTotalClass(vm.eventregistrations | filter: vm.searchFilter | filter: vm.event.name | sumByKey:'balanceAmount')">{{vm.eventregistrations | filter: vm.searchFilter | filter: vm.event.name | sumByKey:'balanceAmount'  | currency:''}}</td>
          </tr>
        </tfoot>
      </table>
    </div>
    <export-to-file link-text="Exportar" element-id="exportable" format="excel" file-name="INSCRIPCIONES"></export-to-file>
  </div>   
  <div class="alert alert-warning text-center" data-ng-if="vm.eventregistrations.$resolved && !vm.eventregistrations.length">
    No Eventregistrations yet, why don't you <a data-ui-sref="eventregistrations.create">create one</a>?
  </div>
</section>
