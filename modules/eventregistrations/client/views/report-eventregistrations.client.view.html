<section>
  <div class="page-header">
    <h1>Repote de Inscripciones</h1>
  </div>
  <br /><br />
  <div id="content">
    <div class="col-md-6 form-group">        
      <label class="control-label" for="event">Evento: </label>  
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.event">
          <ui-select-match  placeholder="Seleccione el tipo de persona...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.events | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.event = undefined" class="btn btn-default"  data-toggle="tooltip" title="Borrar filtro de evento">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div>  
    <div class="form-group col-md-6">        
      <label class="control-label" for="eventPeopleGroup">Grupo *</label>  
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.eventPeopleGroup" >
          <ui-select-match  placeholder="Seleccione el grupo...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.eventPeopleGroups | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.eventPeopleGroup = undefined" class="btn btn-default">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div> 
    <div class="form-group col-md-6">        
      <label class="control-label" for="personType">Tipo de Persona *</label>
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.personType" >
          <ui-select-match  placeholder="Seleccione el grupo...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.personTypes | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.personType = undefined" class="btn btn-default">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div> 
    <br />
    <input class="form-control" ng-model="vm.searchFilter" placeholder="Buscar..." type="text"/>
    <br />
    <div id="exportable" ng-show="vm.event">
		<table class="table table-condensed">
		<thead>
		<tr>
		  <th ng-click="vm.orderByMe('registrationNumber')"># Inscripcion</th>
		  <th ng-click="vm.orderByMe('registrationDate')">Fecha Inscripcion</th>
		  <th ng-click="vm.orderByMe('event.name')">Evento</th>
		  <th ng-click="vm.orderByMe('person.firstName')">Nombre</th>
		  <th ng-click="vm.orderByMe('person.lastName')">1er Apellido</th>
		  <th ng-click="vm.orderByMe('person.secondLastName')">2do Apellido</th>
		  <th ng-click="vm.orderByMe('person.age')">Edad</th>
		  <th ng-click="vm.orderByMe('person.personType.name')">Tipo de Persona</th>
		  <th ng-click="vm.orderByMe('balanceAmount')">Saldo Pendiente â‚¡ </th>
		</tr>
		</thead>
		<tbody>
		<tr ng-repeat="eventRegistration in vm.eventregistrations | orderBy:['eventRegistration.balanceAmount', 'eventRegistration.person.firstName', 'eventRegistration.person.lastName', 'eventRegistration.person.secondLastName', 'eventRegistration.registrationDate','eventRegistration.registrationNumber'] | orderBy: vm.myOrderBy | filter: vm.searchFilter | filter: vm.event.name | filter: vm.eventPeopleGroup.name | filter:vm.personType.name" ng-class="vm.getStatusClass(eventRegistration)">
		  <td>{{eventRegistration.registrationNumber}}</td>
		  <td>{{eventRegistration.registrationDate | date:'dd-MMM-yyyy'}}</td>
		  <td>{{eventRegistration.event.name}}</td>
		  <td>{{eventRegistration.person.firstName}}</td>
		  <td>{{eventRegistration.person.lastName}}</td>
		  <td>{{eventRegistration.person.secondLastName}}</td>
		  <td>{{eventRegistration.person.age}}</td>
		  <td>{{eventRegistration.person.personType.name}}</td>
		  <td>{{eventRegistration.balanceAmount | currency:''}}</td>
		</tr>
		</tbody>
		</table>    
		<div class="col-md-12">            
		  <span><b>Total de Inscripciones:</b> {{(vm.eventregistrations | filter: vm.searchFilter | filter: vm.event.name | filter: vm.eventPeopleGroup.name | filter:vm.personType.name).length}}</span>
		</div>
    </div> 
    <div class="col-md-12" ng-show="vm.event">    
    	<export-to-file link-text="Exportar" element-id="exportable" format="excel" file-name="REPORTE DE INSCRIPCIONES"></export-to-file> 
    </div>   
  </div>   
  <div class="alert alert-warning text-center" data-ng-if="vm.eventregistrations.$resolved && !vm.eventregistrations.length">
    No hay inscripciones en este evento.
  </div>
  <div class="alert alert-warning text-center" data-ng-if="!vm.event">
    <strong>Seleccione el evento de las inscripciones que desea mostrar.</strong>
  </div>
</section>