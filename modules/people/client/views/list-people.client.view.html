<div ng-if="vm.error">
  <br />
  <div class="alert alert-danger">
    <a href="#" class="close" data-dismiss="alert" ng-click='vm.error = undefined'>&times;</a>
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <strong class="text-danger">Error:</strong>
    <span>{{vm.error}}</span>
  </div>
</div>
<div ng-if="vm.success">
  <br />
  <div class="alert alert-success" role="alert">
    <a href="#" class="close" data-dismiss="alert" ng-click='vm.success = undefined'>&times;</a>
    <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
    <strong class="text-success">Operación ejecutada exitosamente:</strong>
    <span>{{vm.success}}</span>
  </div>
</div>
<section>
  <div class="page-header">
    <h1>Lista de Personas</h1>
  </div>
  <a class="btn btn-primary" data-ui-sref="people.create">Nueva Persona</a>
  <br /><br />
  <div id="content" data-ng-if="vm.people.length">
    <div class="col-md-3 form-group">        
      <label class="control-label" for="personType">Tipo de Persona: </label>  
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.personType">
          <ui-select-match  placeholder="Seleccione el tipo de persona...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.personTypes | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.personType = undefined" class="btn btn-default">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div>
    <div class="form-group col-md-3">        
      <label class="control-label" for="serviceArea">Área de Servicio: </label>  
      <div class="input-group select2-bootstrap-append">
        <ui-select ng-model="vm.serviceArea">
          <ui-select-match  placeholder="Seleccione el Área de Servicio...">
                <span>{{$select.selected.name}}</span>
            </ui-select-match>
            <ui-select-choices repeat="item in (vm.personTypes | filter: $select.search) track by item._id">
                <div ng-bind-html="item.name | highlight: $select.search"></div>
            </ui-select-choices>
        </ui-select> 
        <span class="input-group-btn">
          <button type="button" ng-click="vm.serviceArea = undefined" class="btn btn-default">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </span>  
      </div> 
    </div>
    <br />
    <input class="form-control" ng-model="vm.searchFilter" placeholder="Buscar..." type="text"/>
    <br />
    <div id="exportable">
      <table class="table table-condensed">
        <thead>
        <tr>
          <th>Nombre</th>
          <th>Primer Apellido</th>
          <th>Segundo Apellido</th>
          <th>Tipo de Persona</th>
          <th>Áreas de Servicio</th>
          <th>Edad</th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="person in vm.people | orderBy:['person.firstName', 'person.lastName', 'person.secondLastName'] | filter: vm.searchFilter | filter: vm.personType.name | filter:vm.serviceArea.name">
          <td>{{person.firstName}}</td>
          <td>{{person.lastName}}</td>
          <td>{{person.secondLastName}}</td>
          <td>{{person.personType.name}}</td>
          <td>{{vm.getServiceAreaNames(person.serviceArea)}}</td>
          <td>{{person.age}}</td>
          <td>    
            <a data-ui-sref="people.view({ personId: person._id})">Detalles</a>    
          </td>          
          <td>
            <a ng-if="vm.authentication.isUserAdmin()" class="btn btn-default" data-ng-click="vm.remove(person)">
              <i class="glyphicon glyphicon-trash"></i>
            </a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>    
    <export-to-file link-text="Exportar" element-id="exportable" format="excel" file-name="PERSONAS"></export-to-file> 
  </div>   
  <div class="alert alert-warning text-center" data-ng-if="vm.people.$resolved && !vm.people.length">
    No hay ninguna persona creada <a data-ui-sref="people.create">Crear una</a>?
  </div>
</section>